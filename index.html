<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0061a8">
    <meta name="description" content="Build your barangay chatbot in 10 minutes - No coding required">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkJhcmFuZ2F5Qm90IEJ1aWxkZXIiLAogICJzaG9ydF9uYW1lIjogIkJhcmFuZ2F5Qm90IiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwMDYxYTgiLAogICJ0aGVtZV9jb2xvciI6ICIjMDA2MWE4IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpBd0lpQm9aV2xuYUhROUlqSXdNQ0lnZG1sbGQwSnZlRDBpTUNBd0lESXdNQ0F5TURBaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK1BISmxZM1FnZUQwaU1DSWdlVDBpTUNJZ2QybGtkR2c5SWpJd01DSWdhR1ZwWjJoMFBTSXlNREFpSUdacGJHdzlJaU13TURZeFlUZ2lMejQ4TDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    <title>BarangayBot Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0061a8 0%, #003d6b 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #0061a8, #00a8e8);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .logo-text h1 {
            font-size: 24px;
            color: #0061a8;
        }

        .logo-text p {
            font-size: 12px;
            color: #666;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #0061a8;
            color: white;
        }

        .btn-primary:hover {
            background: #004d86;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,97,168,0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sidebar, .preview-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .sidebar h3, .preview-panel h3 {
            color: #0061a8;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .nav-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover {
            background: #f0f8ff;
        }

        .nav-item.active {
            background: #0061a8;
            color: white;
        }

        .builder-area {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .pattern-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .pattern-card:hover {
            border-color: #0061a8;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,97,168,0.2);
        }

        .pattern-card.selected {
            border-color: #0061a8;
            background: #f0f8ff;
        }

        .pattern-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #0061a8, #00a8e8);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            margin-bottom: 15px;
        }

        .connector-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .connector-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .connector-card:hover {
            border-color: #0061a8;
            background: #f0f8ff;
        }

        .connector-card.enabled {
            border-color: #00c853;
            background: #e8f5e9;
        }

        .connector-icon {
            width: 50px;
            height: 50px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .drag-zone {
            border: 3px dashed #ccc;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-top: 20px;
            min-height: 400px;
            background: #fafafa;
            position: relative;
        }

        .drag-zone.drag-over {
            border-color: #0061a8;
            background: #f0f8ff;
        }

        .component-item {
            background: white;
            border: 2px solid #0061a8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.3s;
        }

        .component-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,97,168,0.2);
        }

        .dropped-component {
            background: white;
            border: 2px solid #0061a8;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
            cursor: move;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff5252;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
        }

        .chatbot-preview {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            background: #0061a8;
            color: white;
            margin-right: auto;
        }

        .message.user {
            background: #e0e0e0;
            color: #333;
            margin-left: auto;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .event-rule {
            background: #f9f9f9;
            border-left: 4px solid #0061a8;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .event-rule code {
            background: #333;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            display: block;
            margin-top: 10px;
            font-size: 12px;
            overflow-x: auto;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-live {
            background: #00c853;
            color: white;
        }

        .status-pending {
            background: #ffa726;
            color: white;
        }

        .component-palette {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #0061a8, #00a8e8);
            height: 100%;
            transition: width 0.3s;
        }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #0061a8;
            border-bottom-color: #0061a8;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .template-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .template-card:hover {
            border-color: #0061a8;
            transform: translateX(5px);
        }

        .quick-action {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .quick-action:hover {
            border-color: #0061a8;
            box-shadow: 0 4px 12px rgba(0,97,168,0.2);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #0061a8, #00a8e8);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .settings-group {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #ccc;
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: #00c853;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
        }

        .toggle-switch.active::after {
            left: 26px;
        }

        .analytics-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #0061a8;
        }

        .language-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .lang-option {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lang-option:hover, .lang-option.selected {
            border-color: #0061a8;
            background: #f0f8ff;
        }

        .version-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .version-item:hover {
            border-color: #0061a8;
            transform: translateX(5px);
        }

        .version-item.current {
            border-color: #00c853;
            background: #e8f5e9;
        }

        .team-member {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            background: #f9f9f9;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0061a8, #00a8e8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .role-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .role-admin {
            background: #ff5722;
            color: white;
        }

        .role-editor {
            background: #2196f3;
            color: white;
        }

        .role-viewer {
            background: #9e9e9e;
            color: white;
        }

        .ab-test-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background: white;
        }

        .test-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .metric-box {
            text-align: center;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #0061a8;
        }

        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .notification-toast.show {
            display: flex;
        }

        .schedule-input {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .time-input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .webhook-item {
            background: #f9f9f9;
            border-left: 4px solid #0061a8;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .integration-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            gap: 15px;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .integration-card:hover {
            border-color: #0061a8;
            background: #f0f8ff;
        }

        .integration-card.active {
            border-color: #00c853;
            background: #e8f5e9;
        }

        /* Mobile Optimizations */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .mobile-nav {
                display: block;
            }
            
            .preview-panel {
                position: fixed;
                bottom: -100%;
                left: 0;
                right: 0;
                height: 70vh;
                border-radius: 20px 20px 0 0;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
                transition: bottom 0.3s ease;
                z-index: 999;
            }
            
            .preview-panel.show {
                bottom: 0;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .logo {
                width: 100%;
            }

            .header-actions {
                width: 100%;
                overflow-x: auto;
                display: flex;
                gap: 8px;
                padding-bottom: 5px;
            }

            .header-actions .btn {
                white-space: nowrap;
                font-size: 12px;
                padding: 8px 12px;
            }

            .pattern-grid,
            .connector-grid {
                grid-template-columns: 1fr;
            }

            .builder-area {
                padding: 15px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
                max-height: 90vh;
            }

            .test-metrics,
            .language-selector {
                grid-template-columns: 1fr;
            }

            .schedule-input {
                grid-template-columns: 1fr;
            }

            .drag-zone {
                padding: 20px;
                min-height: 300px;
            }

            h2 {
                font-size: 20px;
            }

            h3 {
                font-size: 16px;
            }
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            padding: 10px;
            z-index: 998;
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 20px;
            flex: 1;
        }

        .mobile-nav-item span {
            font-size: 10px;
            color: #666;
        }

        .mobile-nav-item.active {
            background: #f0f8ff;
            color: #0061a8;
        }

        .mobile-nav-item.active span {
            color: #0061a8;
            font-weight: 600;
        }

        .mobile-preview-toggle {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #0061a8, #00a8e8);
            border-radius: 50%;
            box-shadow: 0 4px 20px rgba(0,97,168,0.4);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 997;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @media (max-width: 1200px) {
            .mobile-preview-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* Touch-friendly improvements */
        @media (max-width: 768px) {
            .btn {
                min-height: 44px;
                touch-action: manipulation;
            }

            .nav-item,
            .component-item,
            .pattern-card,
            .connector-card,
            .quick-action {
                min-height: 52px;
                touch-action: manipulation;
            }

            .toggle-switch {
                width: 60px;
                height: 32px;
            }

            .toggle-switch::after {
                width: 28px;
                height: 28px;
            }

            .toggle-switch.active::after {
                left: 30px;
            }

            input, textarea, select {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body.dark-mode {
                background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
            }

            body.dark-mode .header,
            body.dark-mode .sidebar,
            body.dark-mode .builder-area,
            body.dark-mode .preview-panel,
            body.dark-mode .modal-content {
                background: #2d2d3a;
                color: #e0e0e0;
            }

            body.dark-mode .pattern-card,
            body.dark-mode .connector-card,
            body.dark-mode .component-item {
                border-color: #3d3d4a;
                background: #25252f;
            }

            body.dark-mode .drag-zone {
                background: #25252f;
                border-color: #3d3d4a;
            }

            body.dark-mode .message.user {
                background: #3d3d4a;
                color: #e0e0e0;
            }
        }

        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1001;
            transition: all 0.3s;
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }

        body.dark-mode .dark-mode-toggle {
            background: rgba(45,45,58,0.9);
        }

        /* Offline Mode Indicator */
        .offline-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #ff9800;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255,152,0,0.4);
            z-index: 1001;
            display: none;
            align-items: center;
            gap: 8px;
            animation: slideInDown 0.3s ease;
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .offline-indicator.show {
            display: flex;
        }

        .offline-indicator.online {
            background: #00c853;
        }

        .sync-status {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: white;
            border-radius: 20px;
            padding: 8px 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-size: 12px;
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 1001;
        }

        .sync-status.show {
            display: flex;
        }

        .sync-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #e0e0e0;
            border-top-color: #0061a8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Dark Mode Toggle -->
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
        üåô
    </button>

    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <span>üì°</span>
        <span id="connectionStatus">Offline Mode</span>
    </div>

    <!-- Sync Status -->
    <div class="sync-status" id="syncStatus">
        <div class="sync-spinner"></div>
        <span>Syncing changes...</span>
    </div>

    <!-- Mobile Preview Toggle -->
    <button class="mobile-preview-toggle" onclick="toggleMobilePreview()" title="Preview Bot">
        ü§ñ
    </button>

    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üèõÔ∏è</div>
                <div class="logo-text">
                    <h1>BarangayBot Builder</h1>
                    <p>No-code chatbot for Philippine LGUs</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="showModal('versions')">üïê Versions</button>
                <button class="btn btn-secondary" onclick="showModal('team')">üë• Team</button>
                <button class="btn btn-secondary" onclick="showModal('abtest')">üß™ A/B Test</button>
                <button class="btn btn-secondary" onclick="showModal('templates')">üìö Templates</button>
                <button class="btn btn-secondary" onclick="showModal('analytics')">üìä Analytics</button>
                <button class="btn btn-secondary" onclick="showModal('settings')">‚öôÔ∏è Settings</button>
                <button class="btn btn-secondary" onclick="saveBot()">üíæ Save</button>
                <button class="btn btn-primary" onclick="deployBot()">üöÄ Deploy Bot</button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h3>Build Steps</h3>
                <div class="nav-item active" onclick="showSection('patterns')">
                    üìã 1. Choose Pattern
                </div>
                <div class="nav-item" onclick="showSection('components')">
                    üß© 2. Add Components
                </div>
                <div class="nav-item" onclick="showSection('connectors')">
                    üîå 3. Connect APIs
                </div>
                <div class="nav-item" onclick="showSection('events')">
                    ‚ö° 4. Event Rules
                </div>
                <div class="nav-item" onclick="showSection('preview')">
                    üëÅÔ∏è 5. Preview & Test
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
                    <h3 style="margin-bottom: 15px;">Quick Actions</h3>
                    <div class="quick-action" onclick="importBot()">
                        <div class="action-icon" style="background: linear-gradient(135deg, #673ab7, #9c27b0);">üì•</div>
                        <div>
                            <strong>Import Bot</strong>
                            <p style="font-size: 12px; color: #666;">Load from file</p>
                        </div>
                    </div>
                    <div class="quick-action" onclick="exportBot()">
                        <div class="action-icon" style="background: linear-gradient(135deg, #00c853, #64dd17);">üì§</div>
                        <div>
                            <strong>Export Bot</strong>
                            <p style="font-size: 12px; color: #666;">Save as JSON</p>
                        </div>
                    </div>
                    <div class="quick-action" onclick="duplicateBot()">
                        <div class="action-icon" style="background: linear-gradient(135deg, #ff9800, #ff5722);">üìã</div>
                        <div>
                            <strong>Duplicate</strong>
                            <p style="font-size: 12px; color: #666;">Clone this bot</p>
                        </div>
                    </div>
                    <div class="quick-action" onclick="showModal('schedule')">
                        <div class="action-icon" style="background: linear-gradient(135deg, #e91e63, #9c27b0);">‚è∞</div>
                        <div>
                            <strong>Schedule</strong>
                            <p style="font-size: 12px; color: #666;">Auto-deploy</p>
                        </div>
                    </div>
                    <div class="quick-action" onclick="showModal('integrations')">
                        <div class="action-icon" style="background: linear-gradient(135deg, #00bcd4, #2196f3);">üîó</div>
                        <div>
                            <strong>Integrations</strong>
                            <p style="font-size: 12px; color: #666;">Webhooks</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 20%"></div>
                    </div>
                    <p style="font-size: 12px; color: #666;">Step 1 of 5</p>
                </div>
            </div>

            <div class="builder-area" id="builderArea">
                <!-- Content changes based on section -->
            </div>

            <div class="preview-panel">
                <h3>ü§ñ Live Preview</h3>
                <div class="chatbot-preview">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message bot">
                            Kumusta! I'm your BarangayBot. How can I help you today?
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" placeholder="Type a message..." id="chatInput" onkeypress="handleChatEnter(event)">
                        <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <span class="status-badge status-live">üü¢ Live Preview</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <div class="mobile-nav">
        <div class="mobile-nav-items">
            <div class="mobile-nav-item active" onclick="showSection('patterns')">
                üìã
                <span>Pattern</span>
            </div>
            <div class="mobile-nav-item" onclick="showSection('components')">
                üß©
                <span>Build</span>
            </div>
            <div class="mobile-nav-item" onclick="showSection('connectors')">
                üîå
                <span>APIs</span>
            </div>
            <div class="mobile-nav-item" onclick="showSection('events')">
                ‚ö°
                <span>Events</span>
            </div>
            <div class="mobile-nav-item" onclick="showSection('preview')">
                üëÅÔ∏è
                <span>Preview</span>
            </div>
        </div>
    </div>

    <!-- Version History Modal -->
    <div class="modal" id="versionsModal">
        <div class="modal-content">
            <h2 style="color: #0061a8; margin-bottom: 20px;">üïê Version History</h2>
            <p style="color: #666; margin-bottom: 20px;">Restore or compare previous versions of your bot</p>
            
            <div class="version-item current">
                <div>
                    <strong>v1.4 - Current Version</strong>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Today at 2:30 PM ‚Ä¢ By Juan Dela Cruz</p>
                    <p style="font-size: 13px; margin-top: 8px;">Added PhilHealth integration and 2 event rules</p>
                </div>
                <span class="status-badge status-live">Current</span>
            </div>

            <div class="version-item" onclick="restoreVersion('1.3')">
                <div>
                    <strong>v1.3</strong>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Yesterday at 4:15 PM ‚Ä¢ By Maria Santos</p>
                    <p style="font-size: 13px; margin-top: 8px;">Updated greeting message and menu options</p>
                </div>
                <button class="btn btn-secondary" style="font-size: 12px;">Restore</button>
            </div>

            <div class="version-item" onclick="restoreVersion('1.2')">
                <div>
                    <strong>v1.2</strong>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">3 days ago ‚Ä¢ By Juan Dela Cruz</p>
                    <p style="font-size: 13px; margin-top: 8px;">Connected DSWD API for calamity alerts</p>
                </div>
                <button class="btn btn-secondary" style="font-size: 12px;">Restore</button>
            </div>

            <div class="version-item" onclick="restoreVersion('1.1')">
                <div>
                    <strong>v1.1</strong>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">1 week ago ‚Ä¢ By Pedro Reyes</p>
                    <p style="font-size: 13px; margin-top: 8px;">Initial bot setup with basic components</p>
                </div>
                <button class="btn btn-secondary" style="font-size: 12px;">Restore</button>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px;">
                <strong style="color: #0061a8;">üí° Auto-save enabled</strong>
                <p style="font-size: 12px; color: #666; margin-top: 5px;">Versions are automatically saved every 10 minutes</p>
            </div>

            <button class="btn btn-secondary" style="margin-top: 20px; width: 100%;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- Team Collaboration Modal -->
    <div class="modal" id="teamModal">
        <div class="modal-content">
            <h2 style="color: #0061a8; margin-bottom: 20px;">üë• Team Collaboration</h2>
            <p style="color: #666; margin-bottom: 20px;">Manage who can access and edit this bot</p>
            
            <div style="margin-bottom: 20px;">
                <input type="text" placeholder="Add team member by email..." style="width: calc(100% - 100px); padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                <button class="btn btn-primary" style="margin-left: 10px;" onclick="inviteTeamMember()">Invite</button>
            </div>

            <h3 style="margin: 20px 0 15px 0;">Current Team Members</h3>

            <div class="team-member">
                <div class="avatar">JD</div>
                <div style="flex: 1;">
                    <strong>Juan Dela Cruz</strong>
                    <p style="font-size: 12px; color: #666;">juan.delacruz@barangay.gov.ph</p>
                </div>
                <span class="role-badge role-admin">Admin</span>
            </div>

            <div class="team-member">
                <div class="avatar" style="background: linear-gradient(135deg, #9c27b0, #e91e63);">MS</div>
                <div style="flex: 1;">
                    <strong>Maria Santos</strong>
                    <p style="font-size: 12px; color: #666;">maria.santos@barangay.gov.ph</p>
                </div>
                <span class="role-badge role-editor">Editor</span>
                <button class="btn btn-secondary" style="margin-left: 10px; font-size: 11px;" onclick="changeRole(this)">Change Role</button>
            </div>

            <div class="team-member">
                <div class="avatar" style="background: linear-gradient(135deg, #ff9800, #ff5722);">PR</div>
                <div style="flex: 1;">
                    <strong>Pedro Reyes</strong>
                    <p style="font-size: 12px; color: #666;">pedro.reyes@barangay.gov.ph</p>
                </div>
                <span class="role-badge role-viewer">Viewer</span>
                <button class="btn btn-secondary" style="margin-left: 10px; font-size: 11px;" onclick="removeTeamMember(this)">Remove</button>
            </div>

            <div class="team-member">
                <div class="avatar" style="background: linear-gradient(135deg, #00c853, #64dd17);">AL</div>
                <div style="flex: 1;">
                    <strong>Anna Lopez</strong>
                    <p style="font-size: 12px; color: #666;">anna.lopez@barangay.gov.ph</p>
                </div>
                <span class="role-badge role-editor">Editor</span>
                <button class="btn btn-secondary" style="margin-left: 10px; font-size: 11px;" onclick="changeRole(this)">Change Role</button>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                <strong>üîí Role Permissions</strong>
                <ul style="font-size: 12px; color: #666; margin-top: 8px; padding-left: 20px;">
                    <li><strong>Admin:</strong> Full access - edit, deploy, manage team</li>
                    <li><strong>Editor:</strong> Can edit bot, view analytics</li>
                    <li><strong>Viewer:</strong> Read-only access, can view analytics</li>
                </ul>
            </div>

            <button class="btn btn-secondary" style="margin-top: 20px; width: 100%;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- A/B Testing Modal -->
    <div class="modal" id="abtestModal">
        <div class="modal-content">
            <h2 style="color: #0061a8; margin-bottom: 20px;">üß™ A/B Testing</h2>
            <p style="color: #666; margin-bottom: 20px;">Test different bot versions to optimize performance</p>
            
            <button class="btn btn-primary" style="margin-bottom: 20px;" onclick="createNewTest()">+ Create New Test</button>

            <div class="ab-test-card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3>Test: Greeting Message Variants</h3>
                        <p style="font-size: 12px; color: #666; margin-top: 5px;">Started 3 days ago ‚Ä¢ 847 users tested</p>
                    </div>
                    <span class="status-badge status-live">Running</span>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <div style="border: 2px solid #0061a8; border-radius: 8px; padding: 15px; background: #f0f8ff;">
                        <strong style="color: #0061a8;">Variant A (Control)</strong>
                        <p style="font-size: 13px; color: #666; margin: 10px 0;">"Kumusta! I'm your BarangayBot."</p>
                        <div class="test-metrics">
                            <div class="metric-box">
                                <div class="metric-value">56%</div>
                                <div style="font-size: 11px; color: #666;">Engagement</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">3.2</div>
                                <div style="font-size: 11px; color: #666;">Avg Messages</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">4.2‚òÖ</div>
                                <div style="font-size: 11px; color: #666;">Rating</div>
                            </div>
                        </div>
                    </div>

                    <div style="border: 2px solid #00c853; border-radius: 8px; padding: 15px; background: #e8f5e9;">
                        <strong style="color: #00c853;">Variant B (Winner)</strong>
                        <p style="font-size: 13px; color: #666; margin: 10px 0;">"Magandang araw! Ako ang iyong Barangay Assistant."</p>
                        <div class="test-metrics">
                            <div class="metric-box">
                                <div class="metric-value">68%</div>
                                <div style="font-size: 11px; color: #666;">Engagement</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">4.7</div>
                                <div style="font-size: 11px; color: #666;">Avg Messages</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">4.8‚òÖ</div>
                                <div style="font-size: 11px; color: #666;">Rating</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-primary" onclick="applyWinningVariant()">‚úì Apply Winner</button>
                    <button class="btn btn-secondary" onclick="stopTest()">‚è∏ Stop Test</button>
                </div>
            </div>

            <div class="ab-test-card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3>Test: Response Time vs Accuracy</h3>
                        <p style="font-size: 12px; color: #666; margin-top: 5px;">Completed 1 week ago ‚Ä¢ 1,240 users tested</p>
                    </div>
                    <span class="status-badge" style="background: #9e9e9e; color: white;">Completed</span>
                </div>
                <p style="font-size: 13px; color: #666; margin-top: 10px;">Fast responses won with 12% higher satisfaction</p>
                <button class="btn btn-secondary" style="margin-top: 10px; font-size: 12px;" onclick="viewTestDetails()">View Details</button>
            </div>

            <button class="btn btn-secondary" style="margin-top: 20px; width: 100%;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- Additional Modals from previous code -->
    <div class="modal" id="templatesModal">
        <div class="modal-content">
            <h2 style="color: #0061a8; margin-bottom: 20px;">üìö Bot Templates</h2>
            <p style="color: #666; margin-bottom: 20px;">Quick-start with pre-built barangay bot templates</p>
            
            <div class="template-card" onclick="loadTemplate('emergency')">
                <h3>üö® Emergency Response Bot</h3>
                <p style="color: #666; font-size: 14px; margin: 10px 0;">Pre-configured with calamity alerts, emergency contacts, and real-time disaster updates</p>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <span class="status-badge" style="background: #00c853; color: white;">‚úì DSWD Connected</span>
                    <span class="status-badge" style="background: #2196f3; color: white;">3 Event Rules</span>
                </div>
            </div>

            <div class="template-card" onclick="loadTemplate('services')">
                <h3>üìÑ Document Services Bot</h3>
                <p style="color: #666; font-size: 14px; margin: 10px 0;">Handle clearances, permits, and certifications with automated tracking</p>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <span class="status-badge" style="background: #ff9800; color: white;">5 Components</span>
                    <span class="status-badge" style="background: #9c27b0; color: white;">Form Builder</span>
                </div>
            </div>

            <div class="template-card" onclick="loadTemplate('health')">
                <h3>üè• Health & Wellness Bot</h3>
                <p style="color: #666; font-size: 14px; margin: 10px 0;">PhilHealth inquiries, vaccination schedules, and health program info</p>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <span class="status-badge" style="background: #00c853; color: white;">‚úì PhilHealth API</span>
                    <span class="status-badge" style="background: #2196f3; color: white;">Multi-Agent</span>
                </div>
            </div>

            <div class="template-card" onclick="loadTemplate('complete')">
                <h3>üèõÔ∏è Complete LGU Suite</h3>
                <p style="color: #666; font-size: 14px; margin: 10px 0;">All-in-one bot with every feature enabled - ideal for city halls</p>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <span class="status-badge" style="background: #ff5722; color: white;">6 APIs</span>
                    <span class="status-badge" style="background: #673ab7; color: white;">Premium</span>
                </div>
            </div>

            <button class="btn btn-secondary" style="margin-top: 20px; width: 100%;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <div class="modal" id="analyticsModal">
        <div class="modal-content">
            <h2 style="color: #0061a8; margin-bottom: 20px;">üìä Bot Analytics</h2>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                <div class="analytics-card">
                    <p style="color: #666; font-size: 13px;">Total Conversations</p>
                    <div class="stat-number">1,247</div>
                    <p style="color: #00c853; font-size: 12px; margin-top: 5px;">‚Üë 23% this week</p>
                </div>
                <div class="analytics-card">
                    <p style="color: #666; font-size: 13px;">Avg Response Time</p>
                    <div class="stat-number">0.8s</div>
                    <p style="color: #00c853; font-size: 12px; margin-top: 5px;">‚Üì 15% faster</p>
                </div>
                <div class="analytics-card">
                    <p style="color: #666; font-size: 13px;">Resolution Rate</p>
                    <div class="stat-number">94%</div>
                    <p style="color: #00c853; font-size: 12px; margin-top: 5px;">‚Üë 5% improved</p>
                </div>
                <div class="analytics-card">
                    <p style="color: #666; font-size: 13px;">User Satisfaction</p>
                    <div class="stat-number">4.7‚òÖ</div>
                    <p style="color: #666; font-size: 12px; margin-top: 5px;">Based on 856 ratings</p>
                </div>
            </div>

            <div class="settings-group">
                <h3 style="margin-bottom: 15px;">Top Queries This Week</h3>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                    <span>Barangay clearance requirements</span>
                    <strong style="color: #0061a8;">342 queries</strong>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                    <span>Office hours and schedules</span>
                    <strong style="color: #0061a8;">287 queries</strong>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                    <span>PhilHealth status check</span>
                    <strong style="color: #0061a8;">219 queries</strong>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                    <span>Calamity assistance inquiry</span>
                    <strong style="color: #0061a8;">156 queries</strong>
                </div>
            </div>

            <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" onclick="exportAnalytics()">üì• Export Full Report</button>
            <button class="btn btn-secondary" style="margin-top: 10px; width: 100%;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h2 style="color: #0061a8; margin-bottom: 20px;">‚öôÔ∏è Bot Settings</h2>
            
            <div class="settings-group">
                <h3 style="margin-bottom: 15px;">Language Support</h3>
                <p style="font-size: 13px; color: #666; margin-bottom: 10px;">Select languages your bot will support</p>
                <div class="language-selector">
                    <div class="lang-option selected" onclick="toggleLanguage(this)">
                        <div style="font-size: 24px;">üáµüá≠</div>
                        <div style="font-size: 12px; margin-top: 5px;">Filipino</div>
                    </div>
                    <div class="lang-option selected" onclick="toggleLanguage(this)">
                        <div style="font-size: 24px;">üá¨üáß</div>
                        <div style="font-size: 12px; margin-top: 5px;">English</div>
                    </div>
                    <div class="lang-option" onclick="toggleLanguage(this)">
                        <div style="font-size: 24px;">üåè</div>
                        <div style="font-size: 12px; margin-top: 5px;">Cebuano</div>
                    </div>
                    <div class="lang-option" onclick="toggleLanguage(this)">
                        <div style="font-size: 24px;">üó£Ô∏è</div>
                        <div style="font-size: 12px; margin-top: 5px;">Ilocano</div>
                    </div>
                    <div class="lang-option" onclick="toggleLanguage(this)">
                        <div style="font-size: 24px;">üå¥</div>
                        <div style="font-size: 12px; margin-top: 5px;">Hiligaynon</div>
                    </div>
                    <div class="lang-option" onclick="toggleLanguage(this)">
                        <div style="font-size: 24px;">üèùÔ∏è</div>
                        <div style="font-size: 12px; margin-top: 5px;">Waray</div>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h3 style="margin-bottom: 15px;">Bot Behavior</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #e0e0e0;">
                    <div>
                        <strong>24/7 Availability</strong>
                        <p style="font-size: 12px; color: #666;">Bot responds outside office hours</p>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #e0e0e0;">
                    <div>
                        <strong>Auto-translate</strong>
                        <p style="font-size: 12px; color: #666;">Detect and translate messages</p>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #e0e0e0;">
                    <div>
                        <strong>Collect Feedback</strong>
                        <p style="font-size: 12px; color: #666;">Ask for ratings after conversations</p>
                    </div>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0;">
                    <div>
                        <strong>Human Escalation</strong>
                        <p style="font-size: 12px; color: #666;">Transfer complex queries to staff</p>
                    </div>
                    <div class="toggle-switch" onclick="toggleSetting(this)"></div>
                </div>
            </div>

            <div class="settings-group">
                <h3 style="margin-bottom: 15px;">Notification Channels</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="toggleNotification(this)">üì± SMS</button>
                    <button class="btn btn-primary" onclick="toggleNotification(this)">üìß Email</button>
                    <button class="btn btn-secondary" onclick="toggleNotification(this)">üí¨ Messenger</button>
                    <button class="btn btn-secondary" onclick="toggleNotification(this)">üìû Viber</button>
                </div>
            </div>

            <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" onclick="saveSettings()">üíæ Save Settings</button>
            <button class="btn btn-secondary" style="margin-top: 10px; width: 100%;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content">
            <h2 style="color: #0061a8; margin-bottom: 20px;">‚è∞ Schedule Deployment</h2>
            <p style="color: #666; margin-bottom: 20px;">Automatically deploy bot updates at specific times</p>
            
            <div class="settings-group">
                <h3 style="margin-bottom: 15px;">Schedule Type</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="setScheduleType(this, 'once')">One-Time</button>
                    <button class="btn btn-secondary" onclick="setScheduleType(this, 'recurring')">Recurring</button>
                    <button class="btn btn-secondary" onclick="setScheduleType(this, 'conditional')">Conditional</button>
                </div>
            </div>

            <div class="settings-group">
                <h3 style="margin-bottom: 15px;">Deployment Date & Time</h3>
                <div class="schedule-input">
                    <input type="date" class="time-input" value="2025-11-22">
                    <input type="time" class="time-input" value="02:00">
                    <select class="time-input">
                        <option>Asia/Manila (PHT)</option>
                        <option>UTC</option>
                    </select>
                </div>
            </div>

            <div class="settings-group">
                <h3 style="margin-bottom: 15px;">Pre-deployment Actions</h3>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                    <span>Create backup before deploy</span>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0;">
                    <span>Run automated tests</span>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                    <span>Send notification after deploy</span>
                    <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
                </div>
            </div>

            <button class="btn btn-primary" style="width: 100%;" onclick="scheduleDeployment()">üìÖ Schedule Deployment</button>
            <button class="btn btn-secondary" style="margin-top: 10px; width: 100%;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- Integrations Modal -->
    <div class="modal" id="integrationsModal">
        <div class="modal-content">
            <h2 style="color: #0061a8; margin-bottom: 20px;">üîó Webhooks & Integrations</h2>
            <p style="color: #666; margin-bottom: 20px;">Connect your bot to external services</p>
            
            <h3 style="margin-bottom: 15px;">Active Webhooks</h3>
            
            <div class="webhook-item">
                <div>
                    <strong>Slack Notifications</strong>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">https://hooks.slack.com/services/T00/B00/XXX</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" style="font-size: 11px;" onclick="editWebhook(this)">Edit</button>
                    <button class="btn btn-secondary" style="font-size: 11px;" onclick="deleteWebhook(this)">Delete</button>
                </div>
            </div>

            <div class="webhook-item">
                <div>
                    <strong>SMS Gateway (Twilio)</strong>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Connected to: +63 XXX XXX XXXX</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" style="font-size: 11px;" onclick="editWebhook(this)">Edit</button>
                    <button class="btn btn-secondary" style="font-size: 11px;" onclick="deleteWebhook(this)">Delete</button>
                </div>
            </div>

            <button class="btn btn-primary" style="margin: 20px 0;" onclick="addWebhook()">+ Add New Webhook</button>

            <h3 style="margin-bottom: 15px;">Available Integrations</h3>

            <div class="integration-card" onclick="toggleIntegration(this)">
                <div style="font-size: 32px;">üí¨</div>
                <div style="flex: 1;">
                    <strong>Facebook Messenger</strong>
                    <p style="font-size: 12px; color: #666;">Deploy bot to Messenger</p>
                </div>
                <span class="status-badge status-pending">Connect</span>
            </div>

            <div class="integration-card active">
                <div style="font-size: 32px;">üì±</div>
                <div style="flex: 1;">
                    <strong>Viber Business</strong>
                    <p style="font-size: 12px; color: #666;">Send messages via Viber</p>
                </div>
                <span class="status-badge status-live">‚úì Connected</span>
            </div>

            <div class="integration-card" onclick="toggleIntegration(this)">
                <div style="font-size: 32px;">üìä</div>
                <div style="flex: 1;">
                    <strong>Google Analytics</strong>
                    <p style="font-size: 12px; color: #666;">Track bot interactions</p>
                </div>
                <span class="status-badge status-pending">Connect</span>
            </div>

            <div class="integration-card" onclick="toggleIntegration(this)">
                <div style="font-size: 32px;">üìß</div>
                <div style="flex: 1;">
                    <strong>SendGrid Email</strong>
                    <p style="font-size: 12px; color: #666;">Email notifications</p>
                </div>
                <span class="status-badge status-pending">Connect</span>
            </div>

            <button class="btn btn-secondary" style="margin-top: 20px; width: 100%;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="notification-toast" id="notificationToast">
        <span id="toastIcon" style="font-size: 24px;">‚úì</span>
        <span id="toastMessage">Action completed successfully</span>
    </div>

    <script>
        const state = {
            currentSection: 'patterns',
            selectedPattern: null,
            components: [],
            connectors: [],
            eventRules: [],
            progress: 20,
            isOnline: navigator.onLine,
            pendingSync: [],
            lastSaved: null
        };

        const patterns = [
            {
                id: 'info-desk',
                name: 'Information Desk',
                icon: 'üìö',
                description: 'Answer FAQs about barangay services, schedules, and requirements'
            },
            {
                id: 'service-req',
                name: 'Service Request',
                icon: 'üìù',
                description: 'Handle document requests, clearances, and permits'
            },
            {
                id: 'emergency',
                name: 'Emergency Alert',
                icon: 'üö®',
                description: 'Real-time calamity alerts and emergency fund notifications'
            },
            {
                id: 'multi-agent',
                name: 'Multi-Agent Hub',
                icon: 'ü§ù',
                description: 'Route queries to specialized agents (health, welfare, etc.)'
            }
        ];

        const connectors = [
            { id: 'dswd', name: 'DSWD', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', description: 'Social welfare programs' },
            { id: 'philhealth', name: 'PhilHealth', icon: 'üè•', description: 'Health insurance' },
            { id: 'pagibig', name: 'Pag-IBIG', icon: 'üè†', description: 'Housing fund' },
            { id: 'lto', name: 'LTO', icon: 'üöó', description: 'License verification' },
            { id: 'bir', name: 'BIR', icon: 'üí∞', description: 'Tax records' },
            { id: 'sss', name: 'SSS', icon: 'üìä', description: 'Social security' }
        ];

        const components = [
            { id: 'greeting', name: 'Greeting Message', icon: 'üëã' },
            { id: 'menu', name: 'Menu Options', icon: 'üìã' },
            { id: 'form', name: 'Data Collection Form', icon: 'üìù' },
            { id: 'api-call', name: 'API Integration', icon: 'üîå' },
            { id: 'conditional', name: 'Conditional Logic', icon: '‚öôÔ∏è' },
            { id: 'response', name: 'Response Template', icon: 'üí¨' }
        ];

        function showSection(section) {
            state.currentSection = section;
            const sections = ['patterns', 'components', 'connectors', 'events', 'preview'];
            const index = sections.indexOf(section);
            state.progress = ((index + 1) / 5) * 100;
            document.getElementById('progressBar').style.width = state.progress + '%';
            
            // Update desktop nav
            document.querySelectorAll('.nav-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });

            // Update mobile nav
            document.querySelectorAll('.mobile-nav-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });

            renderSection();
        }

        function renderSection() {
            const area = document.getElementById('builderArea');
            
            switch(state.currentSection) {
                case 'patterns':
                    area.innerHTML = `
                        <h2 style="color: #0061a8; margin-bottom: 10px;">Choose Your Bot Design Pattern</h2>
                        <p style="color: #666; margin-bottom: 20px;">Select the pattern that best fits your barangay's needs</p>
                        <div class="pattern-grid">
                            ${patterns.map(p => `
                                <div class="pattern-card ${state.selectedPattern === p.id ? 'selected' : ''}" onclick="selectPattern('${p.id}')">
                                    <div class="pattern-icon">${p.icon}</div>
                                    <h3>${p.name}</h3>
                                    <p style="color: #666; margin-top: 8px;">${p.description}</p>
                                    ${state.selectedPattern === p.id ? '<span class="status-badge status-live" style="margin-top: 10px;">Selected</span>' : ''}
                                </div>
                            `).join('')}
                        </div>
                        ${state.selectedPattern ? '<button class="btn btn-primary" style="margin-top: 20px;" onclick="showSection(\'components\')">Next: Add Components ‚Üí</button>' : ''}
                    `;
                    break;

                case 'components':
                    area.innerHTML = `
                        <h2 style="color: #0061a8; margin-bottom: 10px;">Build Your Bot Flow</h2>
                        <p style="color: #666; margin-bottom: 20px;">Drag components to create your chatbot conversation</p>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                            <div>
                                <h3 style="margin-bottom: 15px;">Component Palette</h3>
                                <div class="component-palette">
                                    ${components.map(c => `
                                        <div class="component-item" draggable="true" ondragstart="dragStart(event, '${c.id}')">
                                            ${c.icon} ${c.name}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div>
                                <h3 style="margin-bottom: 15px;">Bot Flow</h3>
                                <div class="drag-zone" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                                    <div id="flowArea">
                                        ${state.components.length === 0 ? 
                                            '<p style="color: #999; padding: 80px 0;">Drag components here to build your bot</p>' : 
                                            state.components.map((c, i) => `
                                                <div class="dropped-component">
                                                    ${components.find(comp => comp.id === c.id).icon} ${components.find(comp => comp.id === c.id).name}
                                                    <button class="delete-btn" onclick="removeComponent(${i})">√ó</button>
                                                </div>
                                            `).join('')
                                        }
                                    </div>
                                </div>
                                ${state.components.length > 0 ? '<button class="btn btn-primary" style="margin-top: 20px;" onclick="showSection(\'connectors\')">Next: Connect APIs ‚Üí</button>' : ''}
                            </div>
                        </div>
                    `;
                    break;

                case 'connectors':
                    area.innerHTML = `
                        <h2 style="color: #0061a8; margin-bottom: 10px;">üîå Live Connector Marketplace</h2>
                        <p style="color: #666; margin-bottom: 20px;">Enable government API integrations for your bot</p>
                        <div class="alert">
                            <span style="font-size: 24px;">‚ö°</span>
                            <div>
                                <strong>Real-time Integration</strong>
                                <p style="font-size: 13px; color: #666; margin-top: 4px;">Connectors use secure OAuth 2.0 and are monitored 24/7</p>
                            </div>
                        </div>
                        <div class="connector-grid">
                            ${connectors.map(c => `
                                <div class="connector-card ${state.connectors.includes(c.id) ? 'enabled' : ''}" onclick="toggleConnector('${c.id}')">
                                    <div class="connector-icon">${c.icon}</div>
                                    <div style="flex: 1;">
                                        <h4>${c.name}</h4>
                                        <p style="font-size: 12px; color: #666;">${c.description}</p>
                                        ${state.connectors.includes(c.id) ? '<span class="status-badge status-live" style="margin-top: 5px;">‚úì Enabled</span>' : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${state.connectors.length > 0 ? '<button class="btn btn-primary" style="margin-top: 20px;" onclick="showSection(\'events\')">Next: Configure Events ‚Üí</button>' : ''}
                    `;
                    break;

                case 'events':
                    area.innerHTML = `
                        <h2 style="color: #0061a8; margin-bottom: 10px;">‚ö° Event-Driven Rules (Flink SQL)</h2>
                        <p style="color: #666; margin-bottom: 20px;">Configure real-time responses to events using Stream Governance</p>
                        
                        <div class="tab-buttons">
                            <button class="tab-btn active" onclick="showEventTab('templates')">üìã Templates</button>
                            <button class="tab-btn" onclick="showEventTab('custom')">‚öôÔ∏è Custom SQL</button>
                        </div>

                        <div id="eventContent">
                            <div class="event-rule">
                                <h4>üö® Calamity Fund Alert</h4>
                                <p style="font-size: 13px; color: #666; margin: 8px 0;">Instant notification when calamity funds are released</p>
                                <code>SELECT resident_id, amount, disbursement_date
FROM dswd_calamity_stream
WHERE barangay_code = 'YOUR_BARANGAY'
  AND status = 'APPROVED'
  AND event_time > CURRENT_TIMESTAMP - INTERVAL '5' MINUTE;</code>
                                <button class="btn btn-primary" style="margin-top: 10px; font-size: 12px;" onclick="addEventRule('calamity')">Add Rule</button>
                            </div>

                            <div class="event-rule">
                                <h4>üè• PhilHealth Status Update</h4>
                                <p style="font-size: 13px; color: #666; margin: 8px 0;">Notify residents of health insurance changes</p>
                                <code>SELECT member_id, status_change, effective_date
FROM philhealth_status_stream
WHERE status_change IN ('ACTIVATED', 'RENEWED')
  AND TUMBLE(event_time, INTERVAL '10' MINUTE);</code>
                                <button class="btn btn-primary" style="margin-top: 10px; font-size: 12px;" onclick="addEventRule('philhealth')">Add Rule</button>
                            </div>

                            <div class="event-rule">
                                <h4>üè† Pag-IBIG Loan Approval</h4>
                                <p style="font-size: 13px; color: #666; margin: 8px 0;">Alert residents when housing loans are approved</p>
                                <code>SELECT applicant_id, loan_amount, approval_status
FROM pagibig_loan_stream
WHERE approval_status = 'APPROVED'
  AND processing_time < INTERVAL '24' HOUR;</code>
                                <button class="btn btn-primary" style="margin-top: 10px; font-size: 12px;" onclick="addEventRule('pagibig')">Add Rule</button>
                            </div>
                        </div>

                        ${state.eventRules.length > 0 ? `
                            <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                                <strong style="color: #00c853;">‚úì ${state.eventRules.length} Event Rule(s) Active</strong>
                            </div>
                        ` : ''}
                        
                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="showSection('preview')">Next: Preview & Deploy ‚Üí</button>
                    `;
                    break;

                case 'preview':
                    area.innerHTML = `
                        <h2 style="color: #0061a8; margin-bottom: 10px;">üéâ Your Bot is Ready!</h2>
                        <p style="color: #666; margin-bottom: 20px;">Review your configuration and deploy to production</p>
                        
                        <div style="background: #f9f9f9; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="margin-bottom: 15px;">Bot Configuration Summary</h3>
                            <div style="display: grid; gap: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border-radius: 8px;">
                                    <span><strong>Event Rules:</strong></span>
                                    <span>${state.eventRules.length} active rules</span>
                                </div>
                            </div>
                        </div>

                        <div class="alert">
                            <span style="font-size: 24px;">üöÄ</span>
                            <div>
                                <strong>Deployment Time: ~2 minutes</strong>
                                <p style="font-size: 13px; color: #666; margin-top: 4px;">Your bot will be available at: barangay-${Math.floor(Math.random() * 10000)}.barangaybot.gov.ph</p>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                            <button class="btn btn-secondary" onclick="testBot()">üß™ Run Test Suite</button>
                            <button class="btn btn-primary" onclick="deployBot()">üöÄ Deploy to Production</button>
                        </div>

                        <div style="margin-top: 30px; padding: 20px; background: #f0f8ff; border-radius: 12px; border-left: 4px solid #0061a8;">
                            <h4 style="color: #0061a8; margin-bottom: 10px;">üìä Stream Governance Features Active:</h4>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 8px 0;">‚úì Real-time event processing with Flink SQL</li>
                                <li style="padding: 8px 0;">‚úì Context-aware responses based on citizen data</li>
                                <li style="padding: 8px 0;">‚úì Automatic failover and 99.9% uptime</li>
                                <li style="padding: 8px 0;">‚úì Audit trail and compliance logging</li>
                                <li style="padding: 8px 0;">‚úì Multi-agent orchestration</li>
                            </ul>
                        </div>
                    `;
                    break;
            }
        }

        function selectPattern(patternId) {
            state.selectedPattern = patternId;
            renderSection();
            updatePreview(`Selected ${patterns.find(p => p.id === patternId).name} pattern!`);
            autoSaveOffline();
        }

        function dragStart(event, componentId) {
            event.dataTransfer.setData('componentId', componentId);
        }

        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function dragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function drop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            const componentId = event.dataTransfer.getData('componentId');
            state.components.push({ id: componentId });
            renderSection();
            updatePreview(`Added ${components.find(c => c.id === componentId).name} to flow`);
            autoSaveOffline();
        }

        function removeComponent(index) {
            state.components.splice(index, 1);
            renderSection();
            autoSaveOffline();
        }

        function toggleConnector(connectorId) {
            const index = state.connectors.indexOf(connectorId);
            if (index > -1) {
                state.connectors.splice(index, 1);
                updatePreview(`Disconnected ${connectors.find(c => c.id === connectorId).name}`);
            } else {
                state.connectors.push(connectorId);
                updatePreview(`Connected to ${connectors.find(c => c.id === connectorId).name} API`);
            }
            renderSection();
            autoSaveOffline();
        }

        function addEventRule(ruleType) {
            if (!state.eventRules.includes(ruleType)) {
                state.eventRules.push(ruleType);
                renderSection();
                updatePreview(`Event rule activated: ${ruleType}`);
                autoSaveOffline();
            }
        }

        function showEventTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'custom') {
                document.getElementById('eventContent').innerHTML = `
                    <div style="background: #f9f9f9; border-radius: 8px; padding: 20px;">
                        <h4 style="margin-bottom: 15px;">Custom Flink SQL Query</h4>
                        <textarea style="width: 100%; height: 200px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: monospace; font-size: 13px;" placeholder="SELECT * FROM event_stream WHERE...">SELECT resident_id, event_type, timestamp
FROM barangay_events
WHERE event_type IN ('DOCUMENT_REQUEST', 'EMERGENCY_ALERT')
  AND processing_status = 'PENDING'
  AND TUMBLE(event_time, INTERVAL '5' MINUTE);</textarea>
                        <button class="btn btn-primary" style="margin-top: 15px;" onclick="addCustomRule()">üíæ Save Custom Rule</button>
                    </div>
                `;
            } else {
                renderSection();
            }
        }

        function addCustomRule() {
            state.eventRules.push('custom-rule-' + Date.now());
            updatePreview('Custom event rule saved successfully!');
            showSection('preview');
        }

        function updatePreview(message) {
            const messagesDiv = document.getElementById('chatMessages');
            const botMessage = document.createElement('div');
            botMessage.className = 'message bot';
            botMessage.textContent = message;
            messagesDiv.appendChild(botMessage);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                const messagesDiv = document.getElementById('chatMessages');
                
                // User message
                const userMsg = document.createElement('div');
                userMsg.className = 'message user';
                userMsg.textContent = message;
                messagesDiv.appendChild(userMsg);
                
                input.value = '';
                
                // Bot response
                setTimeout(() => {
                    const botMsg = document.createElement('div');
                    botMsg.className = 'message bot';
                    
                    // Intelligent responses based on message
                    if (message.toLowerCase().includes('calamity') || message.toLowerCase().includes('emergency')) {
                        botMsg.innerHTML = 'üö® <strong>Calamity Fund Status:</strong><br>Your barangay has been approved for emergency relief. Amount: ‚Ç±50,000. Visit the barangay hall with valid ID to claim.';
                    } else if (message.toLowerCase().includes('philhealth') || message.toLowerCase().includes('health')) {
                        botMsg.innerHTML = 'üè• <strong>PhilHealth Update:</strong><br>Your membership is active. Coverage: Up to ‚Ç±100,000 for hospitalization. Bring your PhilHealth ID for claims.';
                    } else if (message.toLowerCase().includes('clearance') || message.toLowerCase().includes('document')) {
                        botMsg.innerHTML = 'üìÑ <strong>Document Request:</strong><br>Requirements: Valid ID, 2x2 photo, ‚Ç±50 fee. Processing time: 1-2 days. Office hours: Mon-Fri, 8AM-5PM.';
                    } else if (message.toLowerCase().includes('schedule') || message.toLowerCase().includes('office')) {
                        botMsg.innerHTML = 'üïê <strong>Office Schedule:</strong><br>Monday-Friday: 8:00 AM - 5:00 PM<br>Saturday: 8:00 AM - 12:00 PM<br>Sunday: Closed';
                    } else {
                        botMsg.textContent = 'I can help you with: üè• PhilHealth, üè† Pag-IBIG, üìÑ Documents, üö® Emergency alerts. What would you like to know?';
                    }
                    
                    messagesDiv.appendChild(botMsg);
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                }, 800);
            }
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function testBot() {
            updatePreview('Running comprehensive test suite...');
            setTimeout(() => {
                updatePreview('‚úì All tests passed! Bot is ready for deployment.');
            }, 2000);
        }

        function deployBot() {
            const deployUrl = `barangay-${Math.floor(Math.random() * 10000)}.barangaybot.gov.ph`;
            updatePreview('üöÄ Deploying your bot...');
            
            setTimeout(() => {
                updatePreview(`‚úì Deployment successful! Your bot is live at: ${deployUrl}`);
                updatePreview('Share this link with your constituents to start receiving inquiries!');
            }, 3000);
        }

        function saveBot() {
            updatePreview('üíæ Bot configuration saved successfully!');
            saveToCache();
            state.lastSaved = new Date().toLocaleString();
            showNotification('üíæ', 'Bot saved locally');
        }

        // Offline Mode & Data Persistence
        const CACHE_NAME = 'barangaybot-v1';
        const DATA_STORE = 'barangaybot-data';

        // Save state to IndexedDB simulation (using in-memory for this demo)
        const offlineStorage = {
            data: {},
            
            save: function(key, value) {
                this.data[key] = JSON.stringify(value);
                console.log('Saved to offline storage:', key);
            },
            
            load: function(key) {
                const value = this.data[key];
                return value ? JSON.parse(value) : null;
            },
            
            clear: function() {
                this.data = {};
            }
        };

        function saveToCache() {
            const saveData = {
                state: state,
                timestamp: Date.now(),
                version: '1.4'
            };
            offlineStorage.save(DATA_STORE, saveData);
            showSyncStatus('Saved locally');
        }

        function loadFromCache() {
            const cached = offlineStorage.load(DATA_STORE);
            if (cached) {
                Object.assign(state, cached.state);
                state.lastSaved = new Date(cached.timestamp).toLocaleString();
                showNotification('‚úì', 'Loaded from offline storage');
                renderSection();
                return true;
            }
            return false;
        }

        function showSyncStatus(message) {
            const syncEl = document.getElementById('syncStatus');
            const spinner = syncEl.querySelector('.sync-spinner');
            const text = syncEl.querySelector('span');
            
            text.textContent = message;
            syncEl.classList.add('show');
            
            setTimeout(() => {
                syncEl.classList.remove('show');
            }, 2000);
        }

        // Network status monitoring
        function updateOnlineStatus() {
            const wasOnline = state.isOnline;
            state.isOnline = navigator.onLine;
            
            const indicator = document.getElementById('offlineIndicator');
            const statusText = document.getElementById('connectionStatus');
            
            if (state.isOnline) {
                indicator.classList.add('online');
                statusText.textContent = 'Back Online';
                indicator.classList.add('show');
                
                if (!wasOnline) {
                    showNotification('‚úì', 'Connection restored!');
                    syncPendingChanges();
                }
                
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 3000);
            } else {
                indicator.classList.remove('online');
                statusText.textContent = 'Offline Mode - Changes saved locally';
                indicator.classList.add('show');
                
                if (wasOnline) {
                    showNotification('üì°', 'Working offline - changes will sync when online');
                }
            }
        }

        function syncPendingChanges() {
            if (state.pendingSync.length > 0) {
                showSyncStatus('Syncing pending changes...');
                
                setTimeout(() => {
                    // Simulate sync
                    state.pendingSync = [];
                    showSyncStatus('All changes synced!');
                    showNotification('‚úì', 'All changes synced to cloud');
                }, 2000);
            }
        }

        // Auto-save with offline support
        function autoSaveOffline() {
            saveToCache();
            
            if (state.isOnline) {
                // Simulate server sync
                console.log('Syncing to server...');
                showSyncStatus('Syncing to cloud...');
            } else {
                state.pendingSync.push({
                    action: 'save',
                    timestamp: Date.now(),
                    data: state
                });
                console.log('Queued for sync when online');
            }
        }

        // Listen for online/offline events
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Periodic connection check
        setInterval(() => {
            updateOnlineStatus();
        }, 30000); // Check every 30 seconds

        function showModal(modalType) {
            closeModal();
            const modal = document.getElementById(modalType + 'Modal');
            if (modal) {
                modal.classList.add('active');
            }
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }

        function loadTemplate(templateType) {
            const templates = {
                'emergency': {
                    pattern: 'emergency',
                    components: ['greeting', 'menu', 'api-call', 'response'],
                    connectors: ['dswd'],
                    eventRules: ['calamity']
                },
                'services': {
                    pattern: 'service-req',
                    components: ['greeting', 'menu', 'form', 'conditional', 'response'],
                    connectors: ['lto', 'bir'],
                    eventRules: []
                },
                'health': {
                    pattern: 'multi-agent',
                    components: ['greeting', 'menu', 'api-call', 'conditional', 'response'],
                    connectors: ['philhealth'],
                    eventRules: ['philhealth']
                },
                'complete': {
                    pattern: 'multi-agent',
                    components: ['greeting', 'menu', 'form', 'api-call', 'conditional', 'response'],
                    connectors: ['dswd', 'philhealth', 'pagibig', 'lto', 'bir', 'sss'],
                    eventRules: ['calamity', 'philhealth', 'pagibig']
                }
            };

            const template = templates[templateType];
            state.selectedPattern = template.pattern;
            state.components = template.components.map(id => ({ id }));
            state.connectors = [...template.connectors];
            state.eventRules = [...template.eventRules];
            state.progress = 100;

            closeModal();
            showSection('preview');
            updatePreview(`‚úì Loaded ${templateType} template successfully!`);
            autoSaveOffline(); // Save after loading template
        }

        function importBot() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const config = JSON.parse(event.target.result);
                        Object.assign(state, config);
                        renderSection();
                        updatePreview('‚úì Bot imported successfully!');
                        autoSaveOffline(); // Save after import
                    } catch (err) {
                        updatePreview('‚ùå Error importing bot. Invalid file format.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function exportBot() {
            const config = JSON.stringify(state, null, 2);
            const blob = new Blob([config], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `barangay-bot-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            updatePreview('‚úì Bot configuration exported!');
        }

        function duplicateBot() {
            const copy = JSON.parse(JSON.stringify(state));
            updatePreview('‚úì Bot duplicated! You can now modify this copy.');
            autoSaveOffline();
        }

        function toggleLanguage(element) {
            element.classList.toggle('selected');
        }

        function toggleSetting(element) {
            element.classList.toggle('active');
        }

        function toggleNotification(button) {
            button.classList.toggle('btn-primary');
            button.classList.toggle('btn-secondary');
        }

        function saveSettings() {
            closeModal();
            updatePreview('‚öôÔ∏è Settings saved successfully!');
        }

        function exportAnalytics() {
            updatePreview('üìä Analytics report exported as PDF!');
        }

        // New feature functions
        function restoreVersion(version) {
            showNotification('üïê', `Restoring version ${version}...`);
            setTimeout(() => {
                closeModal();
                showNotification('‚úì', `Version ${version} restored successfully!`);
                updatePreview(`Restored to version ${version}`);
            }, 1500);
        }

        function inviteTeamMember() {
            const email = event.target.previousElementSibling.value;
            if (email) {
                showNotification('üìß', `Invitation sent to ${email}`);
                event.target.previousElementSibling.value = '';
            }
        }

        function changeRole(button) {
            const roles = ['Admin', 'Editor', 'Viewer'];
            const badge = button.previousElementSibling;
            const currentIndex = roles.findIndex(r => badge.textContent === r);
            const nextIndex = (currentIndex + 1) % roles.length;
            badge.textContent = roles[nextIndex];
            badge.className = `role-badge role-${roles[nextIndex].toLowerCase()}`;
            showNotification('‚úì', `Role changed to ${roles[nextIndex]}`);
        }

        function removeTeamMember(button) {
            const member = button.closest('.team-member');
            const name = member.querySelector('strong').textContent;
            member.style.opacity = '0.5';
            showNotification('‚úì', `${name} removed from team`);
            setTimeout(() => member.remove(), 1000);
        }

        function createNewTest() {
            showNotification('üß™', 'Creating new A/B test...');
            setTimeout(() => {
                showNotification('‚úì', 'New test created! Configure your variants.');
            }, 1000);
        }

        function applyWinningVariant() {
            showNotification('‚úì', 'Applying winning variant to production...');
            setTimeout(() => {
                closeModal();
                showNotification('üéâ', 'Winner applied! Bot updated successfully.');
                updatePreview('Applied winning A/B test variant');
            }, 2000);
        }

        function stopTest() {
            showNotification('‚è∏', 'Stopping A/B test...');
            setTimeout(() => {
                showNotification('‚úì', 'Test stopped. Results saved.');
            }, 1000);
        }

        function viewTestDetails() {
            showNotification('üìä', 'Loading detailed test results...');
        }

        function scheduleDeployment() {
            const date = document.querySelector('input[type="date"]').value;
            const time = document.querySelector('input[type="time"]').value;
            closeModal();
            showNotification('üìÖ', `Deployment scheduled for ${date} at ${time}`);
            updatePreview(`Scheduled deployment for ${date} ${time}`);
        }

        function setScheduleType(button, type) {
            button.parentElement.querySelectorAll('.btn').forEach(b => {
                b.classList.remove('btn-primary');
                b.classList.add('btn-secondary');
            });
            button.classList.remove('btn-secondary');
            button.classList.add('btn-primary');
        }

        function addWebhook() {
            showNotification('üîó', 'Opening webhook configuration...');
            setTimeout(() => {
                showNotification('‚úì', 'Webhook added successfully!');
            }, 1500);
        }

        function editWebhook(button) {
            showNotification('‚úèÔ∏è', 'Opening webhook editor...');
        }

        function deleteWebhook(button) {
            const webhook = button.closest('.webhook-item');
            webhook.style.opacity = '0.5';
            showNotification('‚úì', 'Webhook deleted');
            setTimeout(() => webhook.remove(), 1000);
        }

        function toggleIntegration(card) {
            card.classList.toggle('active');
            const badge = card.querySelector('.status-badge');
            if (card.classList.contains('active')) {
                badge.className = 'status-badge status-live';
                badge.textContent = '‚úì Connected';
                showNotification('‚úì', 'Integration connected successfully!');
            } else {
                badge.className = 'status-badge status-pending';
                badge.textContent = 'Connect';
                showNotification('‚úì', 'Integration disconnected');
            }
        }

        function showNotification(icon, message) {
            const toast = document.getElementById('notificationToast');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            toastIcon.textContent = icon;
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Auto-save functionality
        let autoSaveInterval;
        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                autoSaveOffline();
                const timestamp = new Date().toLocaleTimeString();
                console.log(`Auto-saved at ${timestamp}`);
            }, 60000); // Auto-save every 1 minute for offline mode
        }

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const toggle = document.querySelector('.dark-mode-toggle');
            toggle.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
            showNotification('‚úì', document.body.classList.contains('dark-mode') ? 'Dark mode enabled' : 'Light mode enabled');
        }

        // Mobile preview toggle
        function toggleMobilePreview() {
            const preview = document.querySelector('.preview-panel');
            preview.classList.toggle('show');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + S to save
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveBot();
            }
            // Ctrl/Cmd + D to deploy
            if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                e.preventDefault();
                deployBot();
            }
            // Esc to close modal
            if (e.key === 'Escape') {
                closeModal();
            }
            // Ctrl/Cmd + K for dark mode
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                toggleDarkMode();
            }
        });

        // Touch gestures for mobile
        let touchStartY = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartY = e.changedTouches[0].screenY;
        });

        document.addEventListener('touchend', (e) => {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeDistance = touchStartY - touchEndY;
            if (Math.abs(swipeDistance) > 100) {
                const preview = document.querySelector('.preview-panel');
                if (swipeDistance > 0 && !preview.classList.contains('show')) {
                    // Swipe up - show preview
                    toggleMobilePreview();
                } else if (swipeDistance < 0 && preview.classList.contains('show')) {
                    // Swipe down - hide preview
                    toggleMobilePreview();
                }
            }
        }

        // Add PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showNotification('üì±', 'Install BarangayBot Builder as an app!');
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showNotification('‚úì', 'App installed successfully!');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Responsive drag and drop for mobile
        let isDragging = false;
        let draggedElement = null;

        function setupMobileDragDrop() {
            document.querySelectorAll('.component-item').forEach(item => {
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
                item.addEventListener('touchmove', handleTouchMove, { passive: false });
                item.addEventListener('touchend', handleTouchEnd, { passive: false });
            });
        }

        function handleTouchStart(e) {
            isDragging = true;
            draggedElement = e.target.closest('.component-item');
            if (draggedElement) {
                draggedElement.style.opacity = '0.5';
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (isDragging && draggedElement) {
                const touch = e.touches[0];
                draggedElement.style.position = 'fixed';
                draggedElement.style.left = touch.clientX - 50 + 'px';
                draggedElement.style.top = touch.clientY - 25 + 'px';
            }
        }

        function handleTouchEnd(e) {
            if (isDragging && draggedElement) {
                draggedElement.style.opacity = '1';
                draggedElement.style.position = 'relative';
                draggedElement.style.left = '0';
                draggedElement.style.top = '0';
                
                const touch = e.changedTouches[0];
                const dropZone = document.querySelector('.drag-zone');
                const rect = dropZone.getBoundingClientRect();
                
                if (
                    touch.clientX >= rect.left &&
                    touch.clientX <= rect.right &&
                    touch.clientY >= rect.top &&
                    touch.clientY <= rect.bottom
                ) {
                    const componentId = draggedElement.getAttribute('draggable') ? 
                        draggedElement.textContent.split(' ')[1].toLowerCase() : 
                        'component';
                    state.components.push({ id: componentId });
                    renderSection();
                    showNotification('‚úì', 'Component added!');
                }
            }
            isDragging = false;
            draggedElement = null;
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        }

        // Initialize
        renderSection();
        startAutoSave();
        updateOnlineStatus(); // Check initial connection status
        
        // Try to load from offline cache on startup
        if (loadFromCache()) {
            console.log('Restored from offline storage');
        }
        
        // Add some demo messages
        setTimeout(() => {
            updatePreview('Welcome to BarangayBot Builder! Start by selecting a design pattern.');
            if (!state.isOnline) {
                updatePreview('üì° You are working offline. All changes are saved locally and will sync when online.');
            }
        }, 500);

        // Log offline capabilities
        console.log('üì± Offline Mode Active');
        console.log('‚úì All changes saved locally');
        console.log('‚úì Auto-sync when connection restored');
        console.log('‚úì Works without internet');
    </script>
</body>
</html>>Design Pattern:</strong></span>
                                    <span>${state.selectedPattern ? patterns.find(p => p.id === state.selectedPattern).name : 'Not selected'}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border-radius: 8px;">
                                    <span><strong>Components:</strong></span>
                                    <span>${state.components.length} components</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border-radius: 8px;">
                                    <span><strong>API Connectors:</strong></span>
                                    <span>${state.connectors.length} connected</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border-radius: 8px;">
                                    <span><strong